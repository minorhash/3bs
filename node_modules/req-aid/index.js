var hreq= require('httpreq');
var Database = require('better-sqlite3');
var adb=require('usrdb');
var db = new Database(__dirname+'/db/pid.db');

exports.selPid=function(pid,sec){
var stm=db.prepare('select *,rowid from pid where pid=?');
try{var selpid=stm.get(pid);}
catch(err){console.log(err);}
return selpid

}

exports.getPid=function(pid,sec){
var obj
var url= "https://api.paidy.com/payments/"+pid
const opt= {
headers:{ "Content-Type": "application/json" ,
"Paidy-Version": "2016-07-01",
"Authorization": "Bearer "+sec}
};

hreq.get(url,opt,  function(err,res){
if (err) { return console.log(err); }
else{
obj=JSON.parse(res.body)
    console.log("=== req aid ====")
    console.log(obj.amount)
//    console.log(res.body)
    return obj
}
})
}//getPid

exports.insPid=function(pid,sec){

var url= "https://api.paidy.com/payments/"+pid
const opt= {
headers:{ "Content-Type": "application/json" ,
"Paidy-Version": "2016-07-01",
"Authorization": "Bearer "+sec}
};

hreq.get(url,opt,  function(err,res){
if (err) { return console.log(err); }
else{
var obj=JSON.parse(res.body)
    console.log("=== cli get ====")
    console.log(obj.amount)


var stm=db.prepare('select *,rowid from pid where pid=?');
try{var selpid=stm.all(pid);}
catch(err){console.log(err);}

var stm=db.prepare('insert into pid values(?,?)')

try{stm.run(pid,res.body)}
catch(err){console.log(err);}

}
})
}

